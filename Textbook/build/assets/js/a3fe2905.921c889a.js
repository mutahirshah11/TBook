"use strict";(globalThis.webpackChunkbook=globalThis.webpackChunkbook||[]).push([[958],{2031:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"part2/chapter-6-nodes-topics-services-actions","title":"Nodes, Topics, Services, and Actions","description":"This chapter explores the fundamental communication primitives in ROS 2. We\'ll cover Nodes, the ROS Graph, and the three main communication patterns: Topics (Publisher/Subscriber), Services (Client/Server), and Actions (Goal/Feedback/Result).","source":"@site/docs/part2/chapter-6-nodes-topics-services-actions.md","sourceDirName":"part2","slug":"/part2/chapter-6-nodes-topics-services-actions","permalink":"/Tbook/docs/part2/chapter-6-nodes-topics-services-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/part2/chapter-6-nodes-topics-services-actions.md","tags":[],"version":"current","frontMatter":{"title":"Nodes, Topics, Services, and Actions","sidebar_label":"Chapter 6: Nodes, Topics, Services, and Actions"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 5:ROS 2 Architecture","permalink":"/Tbook/docs/part2/chapter-5-ros2-architecture-and-core-concepts"},"next":{"title":"Chapter 7: Building ROS 2 Packages with Python","permalink":"/Tbook/docs/part2/chapter-7-building-packages"}}');var i=s(4848),t=s(8453);const o={title:"Nodes, Topics, Services, and Actions",sidebar_label:"Chapter 6: Nodes, Topics, Services, and Actions"},l="Chapter 6: Nodes, Topics, Services, and Actions",c={},a=[{value:"1. Introduction to the ROS Graph",id:"1-introduction-to-the-ros-graph",level:2},{value:"Nodes",id:"nodes",level:3},{value:"Key Characteristics:",id:"key-characteristics",level:4},{value:"Lifecycle:",id:"lifecycle",level:4},{value:"Inspection:",id:"inspection",level:4},{value:"2. Topics: Asynchronous Streaming",id:"2-topics-asynchronous-streaming",level:2},{value:"Python Example: Simple Publisher",id:"python-example-simple-publisher",level:3},{value:"Python Example: Simple Subscriber",id:"python-example-simple-subscriber",level:3},{value:"CLI Tools for Topics",id:"cli-tools-for-topics",level:3},{value:"3. Services: Synchronous Request/Response",id:"3-services-synchronous-requestresponse",level:2},{value:"Python Example: Simple Service Server",id:"python-example-simple-service-server",level:3},{value:"Python Example: Simple Service Client",id:"python-example-simple-service-client",level:3},{value:"CLI Tools for Services",id:"cli-tools-for-services",level:3},{value:"4. Actions: Long-Running Goals",id:"4-actions-long-running-goals",level:2},{value:"CLI Tools for Actions",id:"cli-tools-for-actions",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-6-nodes-topics-services-and-actions",children:"Chapter 6: Nodes, Topics, Services, and Actions"})}),"\n",(0,i.jsx)(n.p,{children:"This chapter explores the fundamental communication primitives in ROS 2. We'll cover Nodes, the ROS Graph, and the three main communication patterns: Topics (Publisher/Subscriber), Services (Client/Server), and Actions (Goal/Feedback/Result)."}),"\n",(0,i.jsx)(n.h2,{id:"1-introduction-to-the-ros-graph",children:"1. Introduction to the ROS Graph"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"ROS Graph"})," is a network of ROS 2 elements processing data at the same time. It encompasses all executables and the connections between them if you could map them all out."]}),"\n",(0,i.jsx)(n.h3,{id:"nodes",children:"Nodes"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"Node"})," is the fundamental unit of computation in ROS 2. Each node in a ROS 2 system is responsible for a specific task (e.g., controlling wheel motors, reading laser data, or path planning). By breaking a complex robotic system into many small, modular nodes, the system becomes more robust and easier to debug."]}),"\n",(0,i.jsx)(n.h4,{id:"key-characteristics",children:"Key Characteristics:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Modularity"}),": A robot system is comprised of many nodes working together."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single Purpose"}),": Ideally, a node should perform one specific function."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Discovery"}),": Nodes automatically discover each other on the same network domain."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"lifecycle",children:"Lifecycle:"}),"\n",(0,i.jsx)(n.p,{children:'Nodes have a lifecycle (Unconfigured, Inactive, Active, Finalized) which allows for greater control over the state of the system, though for basic applications, we often just consider them "running" or "stopped".'}),"\n",(0,i.jsx)(n.h4,{id:"inspection",children:"Inspection:"}),"\n",(0,i.jsx)(n.p,{children:"You can see the currently running nodes using the CLI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 node list\n"})}),"\n",(0,i.jsx)(n.p,{children:"And get details about a specific node:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 node info <node_name>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2-topics-asynchronous-streaming",children:"2. Topics: Asynchronous Streaming"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Topics"})," implement a ",(0,i.jsx)(n.strong,{children:"Publisher / Subscriber"}),' model. This is the most common way to move data between nodes. It is a "many-to-many" connection: a node may publish data to any number of topics and have subscriptions to any number of topics.']}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Asynchronous"}),": The publisher sends data without waiting for a reply."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Decoupled"}),": Publishers and subscribers don't need to know about each other's existence."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:"https://docs.ros.org/en/humble/_images/Topic-SinglePublisherandSingleSubscriber.gif",alt:"Topic Diagram"}),"\r\n",(0,i.jsx)(n.em,{children:"(Source: ROS 2 Documentation)"})]}),"\n",(0,i.jsx)(n.h3,{id:"python-example-simple-publisher",children:"Python Example: Simple Publisher"}),"\n",(0,i.jsx)(n.admonition,{title:"Try it yourself",type:"tip",children:(0,i.jsxs)(n.p,{children:["To run this code, you'll need to create a ROS 2 package first. See ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"/Tbook/docs/part2/chapter-7-building-packages",children:"Chapter 7: Building ROS 2 Packages with Python"})})," for step-by-step instructions."]})}),"\n",(0,i.jsxs)(n.p,{children:["Below is a complete, runnable example of a minimal publisher using ",(0,i.jsx)(n.code,{children:"rclpy"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="simple_publisher.py"',children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\nclass SimplePublisher(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('simple_publisher')\r\n        # Create a publisher on the 'topic' topic, with a queue size of 10\r\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\r\n        timer_period = 0.5  # seconds\r\n        # Create a timer to call timer_callback every 0.5 seconds\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n        self.i = 0\r\n\r\n    def timer_callback(self):\r\n        msg = String()\r\n        msg.data = 'Hello World: %d' % self.i\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info('Publishing: \"%s\"' % msg.data)\r\n        self.i += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    simple_publisher = SimplePublisher()\r\n    rclpy.spin(simple_publisher)\r\n    \r\n    # Destroy the node explicitly\r\n    simple_publisher.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"python-example-simple-subscriber",children:"Python Example: Simple Subscriber"}),"\n",(0,i.jsx)(n.p,{children:"Here is the corresponding subscriber."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="simple_subscriber.py"',children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\nclass SimpleSubscriber(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('simple_subscriber')\r\n        # Create a subscription to the 'topic' topic\r\n        self.subscription = self.create_subscription(\r\n            String,\r\n            'topic',\r\n            self.listener_callback,\r\n            10)\r\n        self.subscription  # prevent unused variable warning\r\n\r\n    def listener_callback(self, msg):\r\n        self.get_logger().info('I heard: \"%s\"' % msg.data)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    simple_subscriber = SimpleSubscriber()\r\n    rclpy.spin(simple_subscriber)\r\n\r\n    # Destroy the node explicitly\r\n    simple_subscriber.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cli-tools-for-topics",children:"CLI Tools for Topics"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["List active topics: ",(0,i.jsx)(n.code,{children:"ros2 topic list"})]}),"\n",(0,i.jsxs)(n.li,{children:["See data on a topic: ",(0,i.jsx)(n.code,{children:"ros2 topic echo <topic_name>"})]}),"\n",(0,i.jsxs)(n.li,{children:["Publish data manually: ",(0,i.jsx)(n.code,{children:'ros2 topic pub <topic_name> <msg_type> "<args>"'})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"3-services-synchronous-requestresponse",children:"3. Services: Synchronous Request/Response"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Services"})," implement a ",(0,i.jsx)(n.strong,{children:"Client / Server"}),' model. This pattern is used for "remote procedure calls" or tasks that require a reply.']}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Synchronous"}),": The client sends a request and waits for the server to respond."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"One-to-One"}),": A service is typically hosted by one server node and called by client nodes."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:"https://docs.ros.org/en/humble/_images/Service-SingleServiceClient.gif",alt:"Service Diagram"}),"\r\n",(0,i.jsx)(n.em,{children:"(Source: ROS 2 Documentation)"})]}),"\n",(0,i.jsx)(n.h3,{id:"python-example-simple-service-server",children:"Python Example: Simple Service Server"}),"\n",(0,i.jsxs)(n.p,{children:["This node provides a service that adds two integers. Note: This example uses ",(0,i.jsx)(n.code,{children:"example_interfaces.srv.AddTwoInts"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="simple_service_server.py"',children:"from example_interfaces.srv import AddTwoInts\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass SimpleServiceServer(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('simple_service_server')\r\n        # Create a service named 'add_two_ints'\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info('Incoming request\\na: %d b: %d' % (request.a, request.b))\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    simple_service_server = SimpleServiceServer()\r\n    rclpy.spin(simple_service_server)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"python-example-simple-service-client",children:"Python Example: Simple Service Client"}),"\n",(0,i.jsx)(n.p,{children:"This node calls the service."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="simple_service_client.py"',children:"import sys\r\nfrom example_interfaces.srv import AddTwoInts\r\nimport rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass SimpleServiceClient(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('simple_service_client')\r\n        # Create a client for the 'add_two_ints' service\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('service not available, waiting again...')\r\n        self.req = AddTwoInts.Request()\r\n\r\n    def send_request(self, a, b):\r\n        self.req.a = a\r\n        self.req.b = b\r\n        # Call service asynchronously\r\n        self.future = self.cli.call_async(self.req)\r\n        rclpy.spin_until_future_complete(self, self.future)\r\n        return self.future.result()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    simple_service_client = SimpleServiceClient()\r\n    response = simple_service_client.send_request(int(sys.argv[1]), int(sys.argv[2]))\r\n    simple_service_client.get_logger().info(\r\n        'Result of add_two_ints: %d + %d = %d' %\r\n        (int(sys.argv[1]), int(sys.argv[2]), response.sum))\r\n\r\n    simple_service_client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cli-tools-for-services",children:"CLI Tools for Services"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["List active services: ",(0,i.jsx)(n.code,{children:"ros2 service list"})]}),"\n",(0,i.jsxs)(n.li,{children:["Call a service manually: ",(0,i.jsx)(n.code,{children:'ros2 service call <service_name> <srv_type> "<args>"'})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"4-actions-long-running-goals",children:"4. Actions: Long-Running Goals"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Actions"})," are intended for long-running tasks. They are built on top of topics and services."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),': The client initiates a task (e.g., "move to location X").']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Feedback"}),': The server provides periodic updates (e.g., "distance remaining: 2m").']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Result"}),': The server notifies the client upon completion (e.g., "Goal reached").']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cancellable"}),": The client can cancel the goal mid-execution."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:"https://docs.ros.org/en/humble/_images/Action-SingleActionClient.gif",alt:"Action Diagram"}),"\r\n",(0,i.jsx)(n.em,{children:"(Source: ROS 2 Documentation)"})]}),"\n",(0,i.jsx)(n.p,{children:"Unlike a Service, which blocks until a response is received, an Action client is non-blocking and can receive feedback while the robot is working."}),"\n",(0,i.jsx)(n.h3,{id:"cli-tools-for-actions",children:"CLI Tools for Actions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["List active actions: ",(0,i.jsx)(n.code,{children:"ros2 action list"})]}),"\n",(0,i.jsxs)(n.li,{children:["Send an action goal: ",(0,i.jsx)(n.code,{children:'ros2 action send_goal <action_name> <action_type> "<goal>"'})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);